@model CrossSell_App.Models.PalDetailMapping
@*@{
		ViewBag.Title = "PalDetails";
		Layout = "~/Views/Shared/_Layout.cshtml";
	}*@

<script src="~/Scripts/Multiselect/jquery-1.8.3.min.js"></script>
<link href="~/Scripts/Multiselect/bootstrap-3.0.3.min.css" rel="stylesheet" />
<link href="~/Scripts/Multiselect/bootstrap-multiselect.css" rel="stylesheet" />
@*<script src="~/Scripts/Multiselect/bootstrap-3.0.3.min.js"></script>*@
<script src="~/Scripts/Multiselect/bootstrap-multiselect.js"></script>

<div style="width: 50%;float: right; margin-right:-39%">
	@{ var ddlCompanyId = 0;
		var citems = Model.companyList.ToList();
		//var cids = citems.Select(x => x.Value).ToList();
	}
	@Html.ListBoxFor(model => citems, (List<SelectListItem>)@ViewBag.fillCompanyddl, new { @class = "form-control listbox" })
	<input type="button" id="go" onclick="selectCompanies()" value="Go" style="width:5%;background-color:lightgreen" />

</div>
<div class="col-md-12 top-30">
	<div class="col-md-12 palheaderdiv"><h4>PAL (Portofolio Agile Lab)</h4></div>

	<table class="col-md-7 paltbl top-10">
		<thead>
			<!--table header-->
			<tr>
				<th class="remove-border"></th>
				<th class="paltblheader">
					Protfolio/Accounts
				</th>
				@foreach (var header in Model.companyList)
				{
					<th class="paltblheader">
						@header.Company_Name
					</th>
				}
			</tr>
		</thead>
		<tbody>
			<!--Table Body-->
			@{
				foreach (var item in Model.portfolioTypeList)
				{
					var portfolios = Model.portfolioList.Where(t => t.Portfolio_Type_Id == item.Portfolio_Type_Id);
					var portfolioTypeId = 0;
					foreach (var portfolio in portfolios)
					{
						var portfolioAgileLab = Model.portfolioAgileLab.Where(t => t.Portfolio_Id == portfolio.Portfolio_Id).ToList();
						<tr>
							@if (item.Portfolio_Type_Id != portfolioTypeId)
							{
								<td rowspan="@portfolios.Count()" class="td-padding">
									@item.Portfolio_Type_Name
								</td>

								portfolioTypeId = item.Portfolio_Type_Id;
							}
							<td class="td-padding">
								@portfolio.Portfolio_Name
							</td>
							@foreach (var company in Model.companyList)
							{
								var pal = portfolioAgileLab.Where(t => t.Company_Id == company.Company_Id).FirstOrDefault();
								string isFutureScope = pal!=null?pal.Future_Scope ? "+" : "":"";
								string IsMarketLead = pal!=null?pal.IsMarketLead ? "*" : "":"";
								var dispalyValue = IsMarketLead + isFutureScope;
								var curUsage = pal!=null?pal.Current_Usage:0;
								<td class="text-center">
									<span class="">@curUsage</span><span class="marketleadicon">@IsMarketLead</span><span class="futurescopeicon">@isFutureScope</span>
								</td>
							}
						</tr>
					}
				}
			}


		</tbody>
		<tfoot>
			<tr>
				<td class="remove-border"></td>
				<td class="remove-border"></td>
				@foreach (var company in Model.companyList)
				{
					<td class="remove-border editlink text-center">
						@Html.ActionLink("Edit", "Edit", new { id = company.Company_Id })
					</td>
				}
			</tr>
		</tfoot>
	</table>
</div>
<div class="col-md-12 top-30">
	<div class="margin-top-30 ">    <span style="color:blue;font-weight:bolder">+</span>  “To Be” – Future scope exists in the account</div>
	<div>     <span style="color:green;font-weight:bolder">*</span>   “Lead”  – Most mature account in the tech, to help other accounts</div>
</div>
@*<script src="~/Scripts/jquery-3.3.1.min.js"></script>*@
<script type="text/javascript">
    $(document).ready(function () {
        if ('@ViewBag.Message' != '') {
            debugger;
            var msg = '@ViewBag.Message';
            alert(msg);
		}
		$('.listbox').multiselect({
			includeSelectAllOption: true,

		});
	})

	function selectCompanies(ele) {
		debugger;
		var val = [];
		count = 0;
		$(':checkbox:checked').each(function (i) {
			if ($(this).val().indexOf("multi") < 0) {

				val[count] = $(this).val();
				count++;
			}
		});
		if (val.length > 0) {
			test = JSON.stringify({ 'CompList': val });
			//window.location.href = '/Home/PALReport?CompList="' + ele + '"';
			window.location.href = '/PortfolioAgileLab/PalDetails?id=' + val;
		}
		else {
			alert("Please select the company");
			return false;
		}

	}
</script>




